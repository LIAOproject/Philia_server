# Philia 产品逻辑说明

> 这份文档用通俗的语言解释 Philia 是什么、怎么工作的，适合非技术背景的读者阅读。

---

## 一、Philia 是什么？

**Philia** 是一个 **AI 情感助手**，帮助用户管理和分析人际关系。

想象一下：你有一个特别了解你感情生活的闺蜜/哥们，TA：
- 记得你和某个人之间发生的所有事情
- 能从你们的聊天记录中分析对方的性格和喜好
- 在你纠结的时候给你建议

**Philia 就是这样一个「数字闺蜜」。**

---

## 二、核心概念

### 1. 对象（Target）
你想要分析的那个人。可以是：
- 正在追求的人
- 正在约会的人
- 暧昧对象
- 或者任何你想更了解的人

每个对象有一个「档案卡片」，记录 TA 的基本信息和 AI 总结的性格特点。

### 2. 记忆（Memory）
你和这个对象之间发生的事情。来源有两种：

| 来源 | 说明 |
|------|------|
| 📸 截图上传 | 上传聊天截图，AI 自动识别并提取信息 |
| 💬 对话记录 | 你和 AI 导师聊天时透露的新信息 |

### 3. AI 导师（Mentor）
不同风格的情感咨询师，比如：
- 💕 **温柔姐姐** - 共情倾听，给你温暖
- 🔥 **毒舌闺蜜** - 直接犀利，点醒你
- 📊 **理性分析师** - 逻辑分析，帮你理清思路
- 🎯 **恋爱教练** - 实战建议，教你怎么做

### 4. 对话（Chatbot）
选择一个「对象」+ 一个「导师」，开启一段咨询对话。

---

## 三、数据流转图

```
┌─────────────────────────────────────────────────────────────────┐
│                        用户操作                                   │
└─────────────────────────────────────────────────────────────────┘
                              │
         ┌────────────────────┼────────────────────┐
         ▼                    ▼                    ▼
   ┌──────────┐        ┌──────────┐         ┌──────────┐
   │ 创建对象  │        │ 上传截图  │         │ 开始对话  │
   └──────────┘        └──────────┘         └──────────┘
         │                    │                    │
         ▼                    ▼                    │
   ┌──────────┐        ┌──────────┐               │
   │ 填写基本  │        │  AI 识别  │               │
   │ 信息     │        │ 截图内容  │               │
   └──────────┘        └──────────┘               │
         │                    │                    │
         ▼                    ▼                    ▼
┌─────────────────────────────────────────────────────────────────┐
│                         数据库                                    │
│  ┌─────────┐    ┌─────────┐    ┌─────────┐    ┌─────────┐      │
│  │  对象    │◄──►│  记忆    │    │  导师    │    │  对话    │      │
│  │ Profile │    │ Memory  │    │ Mentor  │    │ Chatbot │      │
│  └─────────┘    └─────────┘    └─────────┘    └─────────┘      │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │   AI 对话引擎    │
                    │                 │
                    │ 1. 理解你的问题  │
                    │ 2. 检索相关记忆  │
                    │ 3. 生成个性化回复│
                    └─────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │   给你回复建议   │
                    └─────────────────┘
```

---

## 四、用户使用流程

### 第一步：创建对象
```
用户 → 点击「添加对象」→ 填写名字、关系状态 → 保存
```

### 第二步：积累记忆（两种方式）

**方式 A：上传截图**
```
用户 → 上传聊天截图 → AI 自动分析 → 提取关键信息 → 存入记忆库
```

例如，你上传一张微信聊天截图，AI 可能会提取出：
- "TA 说周末想去看电影"
- "TA 对你说的笑话有回应，发了哈哈哈"
- "TA 主动问你在干嘛"

**方式 B：对话时自动记录**
```
用户 → 和 AI 导师聊天 → 透露新信息 → AI 自动提取 → 存入记忆库
```

例如，你对 AI 说"TA 昨天突然不回我消息了"，AI 会把这条信息记下来。

### 第三步：开始咨询对话
```
用户 → 选择对象 + 选择导师 → 开始对话
```

AI 导师会：
1. 知道你在聊谁（对象的档案）
2. 记得你们之间发生过什么（记忆库）
3. 用你选择的风格回答你

---

## 五、AI 是怎么「记住」事情的？

这里用到一个叫 **RAG（检索增强生成）** 的技术。简单说：

```
你问：「TA 是不是对我有意思？」
         │
         ▼
┌─────────────────────────────────┐
│  AI 先去记忆库「搜索」相关内容    │
│                                 │
│  找到：                          │
│  - 3天前：TA 主动约你吃饭        │
│  - 1周前：TA 回复消息很慢        │
│  - 2周前：TA 说你很有趣          │
└─────────────────────────────────┘
         │
         ▼
┌─────────────────────────────────┐
│  AI 结合这些信息 + 导师人设       │
│  给出个性化的回答                 │
└─────────────────────────────────┘
```

这就是为什么 AI 能给出「懂你」的建议——因为它参考了你提供的所有历史信息。

---

## 六、关键设计理念

### 1. 记忆会去重
如果你上传两张截图包含相同的对话，AI 会识别出重复，只保留一份。

### 2. 记忆会更新
如果 TA 换了工作，旧的「TA 在 XX 公司上班」会被标记为过时，新的信息会覆盖。

### 3. 时间有权重
更近期的记忆会被优先检索，因为最近发生的事情往往更重要。

### 4. 导师可定制
每个导师除了人设（说话风格），还可以配置：
- 检索多少条记忆
- 记忆的相关性阈值
- 额外的知识库（比如恋爱技巧）

---

## 七、数据关系图

```
                    ┌─────────────┐
                    │   用户      │
                    └─────────────┘
                          │
                          │ 拥有多个
                          ▼
                    ┌─────────────┐
           ┌───────│   对象      │───────┐
           │       │  (Target)   │       │
           │       └─────────────┘       │
           │              │              │
           │              │ 有多条       │
           │              ▼              │
           │       ┌─────────────┐       │
           │       │   记忆      │       │
           │       │  (Memory)   │       │
           │       └─────────────┘       │
           │                             │
           │  选择对象                    │  选择导师
           │                             │
           ▼                             ▼
    ┌─────────────┐               ┌─────────────┐
    │   对话      │◄──────────────│   导师      │
    │ (Chatbot)   │    使用       │  (Mentor)   │
    └─────────────┘               └─────────────┘
           │
           │ 包含多条
           ▼
    ┌─────────────┐
    │   消息      │
    │  (Message)  │
    └─────────────┘
```

---

## 八、一个完整的场景示例

**小明正在追求小红，他使用 Philia 的过程：**

1. **创建对象**：添加「小红」，状态设为「追求中」

2. **上传截图**：把最近一周和小红的微信聊天截图上传
   - AI 识别出：小红喜欢看电影、周末通常有空、回复消息比较慢

3. **开始咨询**：选择「恋爱教练」导师，问「我该怎么约她出来？」

4. **AI 回复**：
   > 根据你们的聊天记录，小红喜欢看电影，而且周末通常有空。
   > 我建议你这样约她：「最近有部 XX 电影很火，周末要不要一起去看？」
   > 这样既自然，又契合她的兴趣。

5. **后续跟进**：约会后，小明告诉 AI「我们昨天看完电影一起吃了饭，她说下次想去爬山」
   - AI 自动记录这条新信息
   - 下次小明问建议时，AI 会知道他们已经约会过，并且小红想去爬山

---

## 九、常见问题

**Q：我的数据安全吗？**
A：所有数据都存储在你自己部署的服务器上，不会上传到任何第三方。

**Q：AI 会不会把我的事告诉别人？**
A：不会。每个用户的数据是完全隔离的，AI 也没有「记忆」跨用户的能力。

**Q：上传的截图会保存吗？**
A：截图只用于分析，分析完成后可以选择不保留原图，只保留提取的文字信息。

**Q：AI 的建议靠谱吗？**
A：AI 的建议基于你提供的信息，信息越完整，建议越靠谱。但最终决定还是要靠你自己判断。

---

## 十、技术架构（简化版）

如果你好奇底层是怎么实现的：

| 组件 | 作用 | 类比 |
|------|------|------|
| 前端 | 用户界面 | 餐厅的菜单和服务员 |
| 后端 | 业务逻辑 | 餐厅的后厨 |
| 数据库 | 存储数据 | 餐厅的仓库 |
| AI 服务 | 图像识别、对话生成 | 餐厅的主厨 |

```
用户手机/电脑
     │
     ▼
┌─────────┐     ┌─────────┐     ┌─────────┐
│  前端   │────►│  后端   │────►│ 数据库  │
│ Next.js │◄────│ FastAPI │◄────│PostgreSQL│
└─────────┘     └─────────┘     └─────────┘
                     │
                     ▼
               ┌─────────┐
               │ AI 服务 │
               │(豆包API)│
               └─────────┘
```

---

*最后更新：2024年12月*
